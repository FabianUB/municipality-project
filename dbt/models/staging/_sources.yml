version: 2

sources:
  - name: raw
    description: |
      Raw data tables from Dagster ETL pipeline. These contain the original data as loaded 
      from Excel files with minimal processing, preserving original data types and formats.
    tables:
      - name: raw_demography_population
        description: |
          Raw population data by municipality and year (1996-2024) from INE (Instituto Nacional de Estadística).
          Contains 227,400+ records covering 28 years of demographic data for Spanish municipalities.
          
          **Data Quality Notes**:
          - Some records have null municipality codes (8,098 records) - this is a known data quality issue
          - Province codes are stored as zero-padded text ("01", "02") and need integer conversion
          - Municipality codes (cmun) are stored as numeric with possible decimal notation ("2.0")
        columns:
          - name: province_code
            description: "Province code as zero-padded text ('01', '02', '11'). Gets converted to integer in staging."
          - name: province_name
            description: "Province name (pre-cleaned by Dagster pipeline)"
          - name: cmun
            description: "Municipality code within province as numeric (1, 2.0, 51). Gets converted to integer in staging."
          - name: municipality_name
            description: "Municipality name (pre-cleaned by Dagster pipeline)"
          - name: population_total
            description: "Total population count (validated non-negative in staging)"
          - name: population_male
            description: "Male population count (validated non-negative in staging)"
          - name: population_female
            description: "Female population count (validated non-negative in staging)"
          - name: data_year
            description: "Year of the data (1996-2024)"
          - name: source_file
            description: "Original Excel source file name for data lineage"
          - name: data_source
            description: "Data source identifier for lineage tracking"
          - name: ingestion_timestamp
            description: "Timestamp when data was ingested by Dagster pipeline"

seeds:
  - name: municipality_dictionary
    description: |
      Complete dictionary of Spanish municipalities with official geographic codes from INE.
      Contains 8,132 municipalities (all Spanish municipalities as of 2025).
      
      **Source of Truth**: This data provides the authoritative integer codes used throughout the project.
      All other models are standardized to match these integer formats for consistent joins.
      
      **Generated by**: Dagster codes_data_etl_pipeline from diccionario25.xlsx
    columns:
      - name: autonomous_community_code
        description: "Autonomous community code as integer (1-19). Source of truth for geographic hierarchy."
      - name: province_code
        description: "Province code as integer (1-52). Source of truth - all other models converted to match this format."
      - name: municipality_code
        description: "Municipality code within province as integer. Source of truth for municipality identification."
      - name: check_digit
        description: "Check digit for code validation (official INE format)"
      - name: municipality_name
        description: "Official municipality name (cleaned by Dagster pipeline)"

  - name: provinces_autonomous_communities
    description: |
      Mapping of Spain's 52 provinces to their 19 autonomous communities.
      Provides the administrative hierarchy for geographic analysis.
      
      **Coverage**: Complete mapping of Spanish administrative divisions
      **Generated by**: Dagster codes_data_etl_pipeline from provinces_ccaa.xlsx
    columns:
      - name: autonomous_community_code
        description: "Autonomous community code as integer (1-19). Links to municipality_dictionary."
      - name: autonomous_community_name
        description: "Official autonomous community name (e.g., 'Andalucía', 'Cataluña')"
      - name: province_code
        description: "Province code as integer (1-52). Links to municipality_dictionary and demography data."
      - name: province_name
        description: "Official province name (e.g., 'Madrid', 'Barcelona')"